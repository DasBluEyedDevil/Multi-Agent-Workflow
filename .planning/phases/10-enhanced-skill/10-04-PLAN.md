---
phase: 10-enhanced-skill
plan: 04
type: execute
wave: 4
depends_on: ["10-01", "10-02", "10-03"]
files_modified:
  - .claude/skills/kimi-delegation/SKILL.md
autonomous: true

must_haves:
  truths:
    - "SKILL.md documents automatic model selection with examples"
    - "Decision tree explains when K2 vs K2.5 is selected"
    - "Override mechanism (KIMI_FORCE_MODEL) is documented"
    - "Cost estimation and confidence thresholds are explained"
  artifacts:
    - path: ".claude/skills/kimi-delegation/SKILL.md"
      provides: "Updated skill documentation with v2.0 patterns"
      min_lines: 120
      contains: ["auto-model", "K2", "K2.5", "confidence", "override"]
  key_links:
    - from: "SKILL.md"
      to: "skills/kimi-model-selector.sh"
      via: "documentation reference"
      pattern: "kimi-model-selector"
---

<objective>
Update SKILL.md with v2.0 delegation patterns including automatic model selection.

Purpose: Document the new intelligent delegation capabilities for Claude Code users, including model selection, confidence thresholds, cost estimation, and override mechanisms.
Output: Updated .claude/skills/kimi-delegation/SKILL.md with v2.0 patterns.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/10-enhanced-skill/10-RESEARCH.md
@.claude/skills/kimi-delegation/SKILL.md (current)
@skills/kimi-model-selector.sh (from 10-02)
@skills/kimi-cost-estimator.sh (from 10-03)
@skills/kimi.agent.wrapper.sh (enhanced in 10-03)

Current SKILL.md covers basic role-based delegation. This plan updates it to include:
- Automatic model selection (K2 vs K2.5)
- File extension mapping
- Task type classification
- Confidence thresholds
- Cost estimation
- Override mechanisms
- Context preservation
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update SKILL.md with v2.0 delegation patterns</name>
  <files>.claude/skills/kimi-delegation/SKILL.md</files>
  <action>
Update .claude/skills/kimi-delegation/SKILL.md to document v2.0 patterns. Keep the existing structure but add new sections:

1. Keep the header (name, description, dependencies)

2. Update "When to Delegate to Kimi" section:
   - Add guidance on K2 vs K2.5 selection
   - K2 for: refactoring, testing, debugging, backend work
   - K2.5 for: UI components, creative features, design work

3. Add new section "Automatic Model Selection":
   - Explain --auto-model flag
   - Show decision tree:
     ```
     Task Analysis
     ├── File Extensions (.tsx/.css → K2.5, .py/.go → K2)
     ├── Task Type (refactor/test → K2, feature/component → K2.5)
     └── Code Patterns (component → K2.5, utility → K2)
     ```
   - Confidence scoring (0-100, threshold 75%)
   - What happens when confidence is low

4. Add new section "Cost Estimation":
   - Explain token estimation (characters / 4)
   - K2.5 cost multiplier (1.5x)
   - Using --show-cost flag
   - When costs are displayed automatically

5. Add new section "Override Mechanisms":
   - KIMI_FORCE_MODEL=k2 or k2.5
   - --model flag (existing, preserve)
   - Override takes precedence over auto-selection

6. Add new section "Context Preservation":
   - --session-id flag
   - KIMI_SESSION_ID environment variable
   - Maintains conversation across related tasks

7. Update "How to Invoke" section:
   - Add --auto-model examples
   - Add --show-cost examples
   - Add --session-id examples
   - Keep existing role-based examples

8. Add new section "Configuration":
   - skills/lib/model-rules.json for extension mappings
   - KIMI_CONFIDENCE_THRESHOLD env var
   - KIMI_COST_THRESHOLD env var

9. Keep existing "Roles" and "Templates" sections

10. Add "Migration from v1.0" section:
    - Existing workflows still work
    - New features are opt-in via flags
    - Gradual adoption path

Use clear examples and preserve all existing content that still applies.
  </action>
  <verify>grep -q "auto-model" .claude/skills/kimi-delegation/SKILL.md && grep -q "K2" .claude/skills/kimi-delegation/SKILL.md && grep -q "confidence" .claude/skills/kimi-delegation/SKILL.md && echo "Required content present"</verify>
  <done>SKILL.md updated with automatic model selection, cost estimation, override mechanisms, context preservation sections, and v2.0 examples</done>
</task>

<task type="auto">
  <name>Task 2: Add decision flow diagram and examples</name>
  <files>.claude/skills/kimi-delegation/SKILL.md</files>
  <action>
Add practical examples and a decision flow to SKILL.md:

1. Add "Quick Reference" section near the top with:
   - Routine task → K2: `./skills/kimi.agent.wrapper.sh --auto-model -r refactorer "Clean up utils.py"`
   - Creative task → K2.5: `./skills/kimi.agent.wrapper.sh --auto-model -r implementer "Create dashboard component"`
   - Force model: `KIMI_FORCE_MODEL=k2.5 ./skills/kimi.agent.wrapper.sh ...`

2. Add "Decision Flow" ASCII diagram:
   ```
   Start
   ├── KIMI_FORCE_MODEL set? → Use that model
   ├── --auto-model flag? → Analyze and select
   │   ├── UI files (.tsx/.css) → K2.5
   │   ├── Backend files (.py/.go) → K2
   │   ├── Task: refactor/test → K2
   │   └── Task: feature/component → K2.5
   └── Otherwise → Use default (kimi-for-coding)
   ```

3. Add "Examples by Task Type" table:
   | Task | Files | Auto-Selected Model |
   |------|-------|---------------------|
   | Refactor Python | *.py | K2 |
   | Create React component | *.tsx | K2.5 |
   | Debug backend | *.go | K2 |
   | Style UI | *.css | K2.5 |

4. Add "Troubleshooting" section:
   - Model not auto-selected: Check --auto-model flag
   - Wrong model selected: Use KIMI_FORCE_MODEL override
   - Cost too high: Use --show-cost to preview
   - Context lost: Use --session-id

Ensure all examples use correct paths (./skills/kimi.agent.wrapper.sh).
  </action>
  <verify>grep -q "Quick Reference" .claude/skills/kimi-delegation/SKILL.md && grep -q "Decision Flow" .claude/skills/kimi-delegation/SKILL.md && echo "Sections added"</verify>
  <done>SKILL.md includes Quick Reference section, Decision Flow diagram, Examples by Task Type table, and Troubleshooting section</done>
</task>

</tasks>

<verification>
1. SKILL.md exists and is valid markdown
2. Contains required sections: Automatic Model Selection, Cost Estimation, Override Mechanisms, Context Preservation
3. Contains K2 and K2.5 references
4. Contains confidence threshold documentation
5. Contains --auto-model examples
6. Contains KIMI_FORCE_MODEL documentation
7. File is at least 120 lines (substantial documentation)
8. All paths reference correct locations (./skills/...)
</verification>

<success_criteria>
- SKILL.md comprehensively documents v2.0 delegation patterns
- Users can understand when K2 vs K2.5 is selected
- Override mechanism is clearly explained
- Cost estimation and confidence thresholds are documented
- Practical examples are provided for common scenarios
- Migration path from v1.0 is clear
</success_criteria>

<output>
After completion, create `.planning/phases/10-enhanced-skill/10-04-SUMMARY.md`
</output>
