---
phase: 05-claude-code-integration
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - .claude/skills/kimi-delegation/SKILL.md
  - .claude/CLAUDE.md.kimi-section
autonomous: true
user_setup: []

must_haves:
  truths:
    - "SKILL.md teaches Claude when and how to invoke Kimi for delegation tasks"
    - "SKILL.md is under 3,000 characters per Claude Code skill budget"
    - "CLAUDE.md section provides delegation rules for users to include in their CLAUDE.md"
  artifacts:
    - path: ".claude/skills/kimi-delegation/SKILL.md"
      provides: "Skill definition for Kimi delegation"
      max_chars: 3000
    - path: ".claude/CLAUDE.md.kimi-section"
      provides: "Template section for user's CLAUDE.md"
      min_lines: 20
  key_links:
    - from: ".claude/skills/kimi-delegation/SKILL.md"
      to: "skills/kimi.agent.wrapper.sh"
      via: "bash command examples"
      pattern: "kimi\\.agent\\.wrapper\\.sh"
    - from: ".claude/CLAUDE.md.kimi-section"
      to: ".claude/skills/kimi-delegation/SKILL.md"
      via: "reference to skill loading"
      pattern: "kimi-delegation"
---

<objective>
Create SKILL.md that teaches Claude when/how to invoke Kimi, and a CLAUDE.md section template with delegation rules.

Purpose: Enable Claude to autonomously decide when to delegate work to Kimi based on task characteristics.
Output: A skill file under 3,000 chars + a template section users can add to their CLAUDE.md.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@skills/kimi.agent.wrapper.sh
@.claude/skills/gemini-research/SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SKILL.md for Kimi delegation</name>
  <files>
    .claude/skills/kimi-delegation/SKILL.md
  </files>
  <action>
Create the `.claude/skills/kimi-delegation/` directory.

Create `SKILL.md` with YAML frontmatter:
```yaml
---
name: Kimi Research Subagent
description: Delegates large-context code analysis to Kimi K2.5. Use when analyzing codebases, tracing bugs across files, reviewing architecture, or performing security audits. Kimi reads and analyzes, Claude implements.
dependencies:
  - kimi-cli
---
```

Content sections (MUST stay under 3,000 chars total):

1. **Header** (1-2 lines): "You have access to Kimi K2.5 as a large-context research assistant. **Use Kimi for reading/analyzing, use yourself for implementation.**"

2. **When to Invoke Kimi** section:
   - ALWAYS use before: reading files >100 lines, understanding unfamiliar code, tracing bugs across files, making multi-component changes, security/architecture reviews
   - DO NOT use for: simple single-file edits, writing code (that's Claude's job), files already analyzed this session

3. **How to Invoke** section:
   - Basic command: `./skills/kimi.agent.wrapper.sh -r <role> "query"`
   - With directory context: `./skills/kimi.agent.wrapper.sh -r <role> -w <path> "query"`

4. **Available Roles** table (compact):
   | Role | Use Case |
   | reviewer | Code quality, bugs, patterns |
   | auditor | Architecture, best practices |
   | debugger | Bug tracing, root cause (can write/execute) |
   | security | Security vulnerabilities |
   | refactorer | Restructuring suggestions (can write) |
   | implementer | Feature implementation (can write) |
   | simplifier | Complexity reduction (can write) |

5. **Templates** (brief):
   - `-t verify --diff` for post-change verification
   - `-t feature` for feature planning
   - `-t bug` for bug analysis

6. **Response Format** (brief):
   SUMMARY → FILES → ANALYSIS → RECOMMENDATIONS

7. **Workflow Pattern** (3 steps):
   1. Research: Invoke Kimi to understand context
   2. Implement: Claude writes code based on analysis
   3. Verify: Invoke Kimi to verify changes

CRITICAL: Count characters before finalizing. Must be <3,000 chars. Cut examples and reduce verbosity if needed. The gemini SKILL.md is ~3,100 chars -- aim for ~2,500-2,800 chars to be safe.
  </action>
  <verify>
```bash
# File exists
cat .claude/skills/kimi-delegation/SKILL.md

# Character count is under 3,000
wc -c .claude/skills/kimi-delegation/SKILL.md
# Should show < 3000
```
  </verify>
  <done>
SKILL.md exists in .claude/skills/kimi-delegation/
SKILL.md is under 3,000 characters
SKILL.md contains: frontmatter, when to invoke, how to invoke, roles table, templates, response format, workflow
  </done>
</task>

<task type="auto">
  <name>Task 2: Create CLAUDE.md section template</name>
  <files>
    .claude/CLAUDE.md.kimi-section
  </files>
  <action>
Create `.claude/CLAUDE.md.kimi-section` as a template users can copy into their CLAUDE.md.

Structure the section as follows:

```markdown
## Kimi Context Companion

**Division of labor:** Kimi = Eyes (K2.5 large context analysis), Claude = Hands (implementation)

**Workflow:** Analyze (Kimi) -> Implement (Claude) -> Verify (Kimi)

## Delegation Rules

**Delegate to Kimi when:** >100 lines, multiple files, unfamiliar code, tracing logic, pre-implementation exploration, post-change verification.

**Handle directly:** Single-file edits, new code, tests/builds, docs.

| Task | Command |
|------|---------|
| Explore | `./skills/kimi.agent.wrapper.sh -r reviewer "query"` |
| Plan | `./skills/kimi.agent.wrapper.sh -r reviewer -t feature "query"` |
| Debug | `./skills/kimi.agent.wrapper.sh -r debugger "query"` |
| Security | `./skills/kimi.agent.wrapper.sh -r security "query"` |
| Verify | `./skills/kimi.agent.wrapper.sh -t verify --diff "query"` |

## Slash Commands

`/kimi-analyze` | `/kimi-trace` | `/kimi-verify` | `/kimi-audit`

## Roles

`reviewer` `auditor` `debugger` `security` `refactorer` `implementer` `simplifier`
```

Key points:
- Keep it concise -- this goes in users' CLAUDE.md files
- Include the command table for quick reference
- List available slash commands
- List available roles
- Match the style of the existing Gemini section in the project's CLAUDE.md
  </action>
  <verify>
```bash
# File exists and has content
cat .claude/CLAUDE.md.kimi-section

# Contains delegation rules
grep -c "Delegate to Kimi" .claude/CLAUDE.md.kimi-section
# Should return 1

# Contains command table
grep -c "kimi.agent.wrapper.sh" .claude/CLAUDE.md.kimi-section
# Should return >= 5
```
  </verify>
  <done>
CLAUDE.md.kimi-section template exists
Contains division of labor description
Contains delegation rules (when to use Kimi vs handle directly)
Contains command table with 5 common invocations
Contains slash commands list
Contains roles list
  </done>
</task>

</tasks>

<verification>
Both files exist:
```bash
ls -la .claude/skills/kimi-delegation/
ls -la .claude/CLAUDE.md.kimi-section
```

SKILL.md character count:
```bash
wc -c .claude/skills/kimi-delegation/SKILL.md
# Must be < 3000
```

SKILL.md contains required sections:
```bash
grep -E "(When to Invoke|How to Invoke|Available Roles|Response Format)" .claude/skills/kimi-delegation/SKILL.md | wc -l
# Should be 4
```
</verification>

<success_criteria>
- SKILL.md exists in .claude/skills/kimi-delegation/
- SKILL.md is under 3,000 characters
- SKILL.md has YAML frontmatter with name, description, dependencies
- SKILL.md teaches when and how to invoke Kimi
- CLAUDE.md.kimi-section template exists
- Template contains delegation rules
- Template contains command table
- Requirements INTG-05, INTG-06 satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/05-claude-code-integration/05-02-SUMMARY.md`
</output>
