---
phase: 02-agent-roles
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .kimi/agents/reviewer.yaml
  - .kimi/agents/reviewer.md
  - .kimi/agents/security.yaml
  - .kimi/agents/security.md
  - .kimi/agents/auditor.yaml
  - .kimi/agents/auditor.md
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Analysis role agent files exist and are syntactically valid YAML"
    - "Analysis roles cannot write files or execute shell commands"
    - "All analysis roles use structured output format"
  artifacts:
    - path: ".kimi/agents/reviewer.yaml"
      provides: "Reviewer agent configuration with tool exclusions"
      contains: ["version: 1", "extend: default", "exclude_tools"]
    - path: ".kimi/agents/reviewer.md"
      provides: "Reviewer system prompt with structured output"
      contains: ["## SUMMARY", "## FILES", "## ANALYSIS", "## RECOMMENDATIONS"]
    - path: ".kimi/agents/security.yaml"
      provides: "Security agent configuration with tool exclusions"
      contains: ["version: 1", "extend: default", "exclude_tools"]
    - path: ".kimi/agents/security.md"
      provides: "Security system prompt with structured output"
      contains: ["## SUMMARY", "## FILES", "## ANALYSIS", "## RECOMMENDATIONS"]
    - path: ".kimi/agents/auditor.yaml"
      provides: "Auditor agent configuration with tool exclusions"
      contains: ["version: 1", "extend: default", "exclude_tools"]
    - path: ".kimi/agents/auditor.md"
      provides: "Auditor system prompt with structured output"
      contains: ["## SUMMARY", "## FILES", "## ANALYSIS", "## RECOMMENDATIONS"]
  key_links:
    - from: "*.yaml"
      to: "*.md"
      via: "system_prompt_path field"
      pattern: "system_prompt_path:.*\\.md"
    - from: "analysis roles"
      to: "tool restrictions"
      via: "exclude_tools array"
      pattern: "exclude_tools:.*[Ss]hell.*[Ww]rite"
---

<objective>
Create 3 analysis role agent configurations (reviewer, security, auditor) with YAML files and system prompt markdown files. Analysis roles have read-only tool access.

Purpose: Enable users to delegate code analysis tasks (reviews, security scans, audits) to Kimi agents that cannot modify files or execute commands.
Output: 3 agent YAML files and 3 system prompt markdown files in .kimi/agents/
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/02-agent-roles/02-CONTEXT.md
@.planning/phases/02-agent-roles/02-RESEARCH.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create reviewer agent</name>
  <files>
    .kimi/agents/reviewer.yaml
    .kimi/agents/reviewer.md
  </files>
  <action>
    Create .kimi/agents/reviewer.yaml with the following structure:
    - version: 1
    - agent.extend: default
    - agent.name: reviewer
    - agent.system_prompt_path: ./reviewer.md
    - agent.exclude_tools: ["kimi_cli.tools.shell:Shell", "kimi_cli.tools.file:WriteFile", "kimi_cli.tools.file:StrReplaceFile", "kimi_cli.tools.plan:SetTodoList", "kimi_cli.tools.agent:CreateSubagent"]
    
    Create .kimi/agents/reviewer.md with sections in order:
    1. **Identity**: Brief statement "You are the Reviewer agent, a code review specialist."
    2. **Objective**: Perform thorough code reviews with language-specific criteria
    3. **Process**: 
       - Read all relevant source files
       - Identify issues by language (Python: PEP 8, TypeScript: strict typing, bash: shellcheck principles)
       - Check for common anti-patterns per language
    4. **Output Format** (MUST use exact structure):
       ```
       ## SUMMARY
       [brief overview of findings]
       
       ## FILES
       [list of files analyzed]
       
       ## ANALYSIS
       [detailed findings with line numbers and severity]
       
       ## RECOMMENDATIONS
       [actionable next steps]
       ```
    5. **Constraints**: You are a subagent reporting back to Claude. Do not modify files.
    
    Use ${KIMI_WORK_DIR} for file paths and ${KIMI_NOW} for timestamp if needed.
  </action>
  <verify>
    Test YAML syntax: `python3 -c "import yaml; yaml.safe_load(open('.kimi/agents/reviewer.yaml'))"`
    Verify markdown exists and contains all 4 output sections
  </verify>
  <done>
    reviewer.yaml exists with version: 1, extend: default, and exclude_tools for Shell/WriteFile/StrReplaceFile
    reviewer.md exists with Identity → Objective → Process → Output → Constraints sections and SUMMARY/FILES/ANALYSIS/RECOMMENDATIONS output format
  </done>
</task>

<task type="auto">
  <name>Task 2: Create security agent</name>
  <files>
    .kimi/agents/security.yaml
    .kimi/agents/security.md
  </files>
  <action>
    Create .kimi/agents/security.yaml with the same YAML structure as reviewer but with name: security and system_prompt_path: ./security.md.
    
    Create .kimi/agents/security.md with sections:
    1. **Identity**: "You are the Security agent, a security vulnerability specialist."
    2. **Objective**: Scan for code vulnerabilities, secrets exposure, dependency issues, and infrastructure security
    3. **Process**:
       - Read all source files and configuration files
       - Check for OWASP-style vulnerabilities (injection, XSS, auth issues, etc.)
       - Scan for secrets/hardcoded credentials
       - Review dependency files for known vulnerabilities
       - Check infrastructure configs (Dockerfile, docker-compose, CI/CD)
    4. **Output Format** (same exact structure as reviewer)
    5. **Constraints**: You are a subagent reporting back to Claude. Do not modify files.
  </action>
  <verify>
    Test YAML syntax and verify markdown has all required sections
  </verify>
  <done>
    security.yaml exists with proper exclusions, security.md has complete prompt with OWASP coverage
  </done>
</task>

<task type="auto">
  <name>Task 3: Create auditor agent</name>
  <files>
    .kimi/agents/auditor.yaml
    .kimi/agents/auditor.md
  </files>
  <action>
    Create .kimi/agents/auditor.yaml with the same YAML structure but with name: auditor and system_prompt_path: ./auditor.md.
    
    Create .kimi/agents/auditor.md with sections:
    1. **Identity**: "You are the Auditor agent, a code quality and architecture specialist."
    2. **Objective**: Assess code quality, architecture conformance, and best practices adherence
    3. **Process**:
       - Read source files comprehensively
       - Evaluate against language best practices
       - Check for dead code, duplication, complexity issues
       - Assess architecture patterns and consistency
       - Identify technical debt and maintenance concerns
    4. **Output Format** (same exact structure as reviewer)
    5. **Constraints**: You are a subagent reporting back to Claude. Do not modify files.
  </action>
  <verify>
    Test YAML syntax and verify markdown has all required sections
  </verify>
  <done>
    auditor.yaml exists with proper exclusions, auditor.md has complete prompt with quality/architecture coverage
  </done>
</task>

</tasks>

<verification>
- All 6 files exist in .kimi/agents/
- All YAML files pass syntax validation
- All YAML files have exclude_tools with Shell, WriteFile, StrReplaceFile
- All markdown files have SUMMARY/FILES/ANALYSIS/RECOMMENDATIONS sections
- All prompts use ${KIMI_WORK_DIR} and ${KIMI_NOW} variables
- All prompts include "subagent reporting back to Claude" constraint
</verification>

<success_criteria>
- 3 analysis role YAML files created with proper tool exclusions
- 3 system prompt markdown files created with structured output format
- All files follow the research-specified patterns
- Analysis roles are ready for testing in Plan 03
</success_criteria>

<output>
After completion, create `.planning/phases/02-agent-roles/02-01-SUMMARY.md`
</output>
