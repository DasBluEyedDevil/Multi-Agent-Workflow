#!/bin/bash
# kimi-hooks-setup: Setup helper for Kimi git hooks

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/.." && pwd)"

# Source the installation library
source "$PROJECT_ROOT/hooks/lib/install.sh"

VERSION="1.0.0"

show_help() {
    cat << EOF
Kimi Git Hooks Setup Helper v${VERSION}

Usage: kimi-hooks-setup <command> [options]

Commands:
  install [--global|--local]   Install hooks (default: local)
  uninstall [--global|--local] Uninstall hooks (default: all)
  status                       Show installation status
  --help                       Show this help message
  --version                    Show version

Examples:
  kimi-hooks-setup install --global    # Install hooks globally
  kimi-hooks-setup install --local     # Install hooks in current repo
  kimi-hooks-setup uninstall           # Remove all hooks
  kimi-hooks-setup status              # Check what's installed

Global hooks apply to all repositories (requires Git 2.9+).
Local hooks apply only to the current repository.
EOF
}

cmd_install() {
    local scope="local"
    
    while [[ $# -gt 0 ]]; do
        case "$1" in
            --global)
                scope="global"
                shift
                ;;
            --local)
                scope="local"
                shift
                ;;
            *)
                echo "Unknown option: $1"
                show_help
                exit 1
                ;;
        esac
    done
    
    if [[ "$scope" == "global" ]]; then
        hooks_install_global
    else
        hooks_install_local
    fi
}

cmd_uninstall() {
    local scope="all"
    
    while [[ $# -gt 0 ]]; do
        case "$1" in
            --global)
                scope="global"
                shift
                ;;
            --local)
                scope="local"
                shift
                ;;
            *)
                echo "Unknown option: $1"
                show_help
                exit 1
                ;;
        esac
    done
    
    hooks_uninstall "$scope"
}

cmd_status() {
    hooks_status
}

main() {
    case "${1:-}" in
        install)
            shift
            cmd_install "$@"
            ;;
        uninstall)
            shift
            cmd_uninstall "$@"
            ;;
        status)
            shift
            cmd_status "$@"
            ;;
        --help|-h)
            show_help
            ;;
        --version|-v)
            echo "kimi-hooks-setup v${VERSION}"
            ;;
        *)
            echo "Unknown command: ${1:-}"
            show_help
            exit 1
            ;;
    esac
}

main "$@"
